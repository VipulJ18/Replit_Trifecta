# GitHub PR Triaging Agent

## Overview
An autonomous Flask-based webhook service that receives GitHub pull request events, analyzes them with AI, and routes notifications to appropriate Slack channels based on severity.

## Recent Changes (2025-11-08)
- Initial project setup with Flask web framework
- Implemented `/api/github-webhook` endpoint for receiving GitHub webhooks
- Added OpenAI integration for AI-powered code review
- Implemented smart Slack routing based on AI verdict (CRITICAL/NEEDS_REVIEW/GOOD)
- Configured comprehensive error handling with guaranteed 200 OK responses

## Architecture

### Core Components
1. **Webhook Endpoint** (`/api/github-webhook`)
   - Receives GitHub pull request events
   - Filters for `pull_request` events with `opened` action
   - Extracts diff_url and html_url from payload

2. **GitHub Integration**
   - Fetches PR diff content using authenticated requests
   - Uses GITHUB_TOKEN for authentication

3. **AI Analysis**
   - Uses OpenAI GPT-4o-mini for code review
   - Returns structured JSON with verdict and comment
   - Verdicts: GOOD, NEEDS_REVIEW, CRITICAL

4. **Slack Routing**
   - CRITICAL → #dev-urgent (with @here mention)
   - NEEDS_REVIEW → #dev-main
   - GOOD → #dev-feed

### Environment Variables Required
- `OPENAI_API_KEY` - OpenAI API key for AI analysis
- `SLACK_BOT_TOKEN` - Slack bot token for posting messages
- `GITHUB_TOKEN` - GitHub token for authenticated diff fetching (optional but recommended)

### Project Structure
```
.
├── main.py              # Flask application with webhook logic
├── requirements.txt     # Python dependencies (auto-generated by uv)
├── pyproject.toml       # Python project configuration
└── replit.md           # Project documentation
```

## User Preferences
- Use Python 3.11
- Use Flask web framework
- Follow specifications from requirements document
- Always return 200 OK to GitHub webhooks (prevents webhook deactivation)

## Next Steps
- Configure GitHub webhook to point to this endpoint
- Set up Slack bot with permissions for the three channels
- Add monitoring and logging for webhook events
- Consider adding rate limiting for production use
